{{ define "partials/job_row" }}
<tr id="{{ .ViewModel.Name }}">
	<td> <!-- status -->
		{{ if .ViewModel.Current }}
		<div uk-tooltip="Job is currently running" uk-spinner="ration: 0.5"></div>
		{{ else if .ViewModel.Last }}
		{{ if .ViewModel.Last.State | eq "cancelled" }}
		<span class="uk-text-warning" uk-icon="warning" uk-tooltip="Last invocation cancelled"></span>
		{{ else if .ViewModel.Last.State | eq "failed" }}
		<span class="uk-text-danger" uk-icon="warning" uk-tooltip="Last invocation failed"></span>
		{{ else if .ViewModel.Last.State | eq "complete" }}
		<span class="uk-text-success" uk-icon="check" uk-tooltip="Last invocation completed successfully"></span>
		{{ else }}
		<span class="uk-text-primary" uk-icon="question" uk-tooltip="Last invocation state is unknown"></span>
		{{ end }}
		{{ else }}
		<span class="uk-text-primary" uk-icon="question" uk-tooltip="Job has no history"></span>
		{{ end }}
	</td>
	<td>
		<a class="uk-button uk-button-link" href="/job/{{ .ViewModel.Name }}">{{ .ViewModel.Name }}</a>
	</td>
	<td class="uk-width-1-6"> <!-- job labels-->
	{{ range $key, $value := .ViewModel.Labels}}
		<div>
			<span class="uk-label">
				<a href="/search?selector={{ $key | urlencode }}={{ $value | slugify }}">{{ $key }}={{ $value | slugify }}</a>
			</span>
		</div>
	{{ end }}
	</td>
	<td><!-- job history -->
		{{ if call .ViewModel.HistoryDisabledProvider }}
		<span class="uk-label uk-label-danger">Disabled</span>
		{{ else }}

		{{ $historyMaxCount := call .ViewModel.HistoryMaxCountProvider }}
		{{ $historyMaxAge := call .ViewModel.HistoryMaxAgeProvider }}
		{{ $historyDescription := "is unlimited" }}
		{{ if ( and ($historyMaxCount) ($historyMaxAge ) ) }}
		{{ $historyDescription = (printf "is limited to %d items or %v age" $historyMaxCount $historyMaxAge) }}
		{{ else if ($historyMaxCount) }}
		{{ $historyDescription = (printf "is limited to %d items" $historyMaxCount) }}
		{{ else if ($historyMaxAge) }}
		{{ $historyDescription = (printf "is limited to %v age" $historyMaxAge) }}
		{{ end }}

		<span class="uk-label uk-label-success" uk-tooltip="History {{ $historyDescription }}">Enabled</span>
		{{ end }}
		{{ if call .ViewModel.HistoryPersistenceDisabledProvider }}
		<span class="uk-label uk-label-warning" uk-tooltip="History is not persisted">Ephemeral</span>
		{{ else }}
		<span class="uk-label uk-label-success" uk-tooltip="History is persisted">Persisted</span>
		{{ end }}
	</td>
	<td> <!-- schedule -->
	{{ if .ViewModel.Schedule }}
		{{ .ViewModel.Schedule }}
	{{ else }}
		<span>-</span>
	{{ end }}
	</td>
	<td> <!-- next run-->
	{{ if .ViewModel.Disabled }}
		<span>-</span>
	{{ else }}
		{{ .ViewModel.NextRuntime | rfc3339 }}
	{{ end }}
	</td>
	<td> <!-- last run -->
	{{ if .ViewModel.Last }}
		{{ .ViewModel.Last.Finished | since_utc | duration_round_seconds }} ago
	{{ else }}
		<span class="none">-</span>
	{{ end }}
	</td>
	<td> <!-- last elapsed -->
	{{ if .ViewModel.Last }}
		{{ .ViewModel.Last.Elapsed | duration_round_millis }}
	{{ else }}
		<span class="none">-</span>
	{{ end }}
	</td>
	<td> <!-- job links -->
		{{ if .ViewModel.Current }}
		<a class="uk-button uk-button-secondary" href="/job.invocation/{{ .ViewModel.Name }}/{{ .ViewModel.Current.ID }}" uk-icon="reply" uk-tooltip="Show the current invocation output"></a>
		{{ else if .ViewModel.Last }}
		<a class="uk-button uk-button-default" href="/job.invocation/{{ .ViewModel.Name }}/{{ .ViewModel.Last.ID }}" uk-icon="reply" uk-tooltip="Show the last invocation output"></a>
		{{ else }}
		<a class="uk-button uk-button-default uk-button-disabled" uk-icon="history" uk-tooltip="Job has no history" disabled></a>
		{{ end }}
		<a class="uk-button uk-button-default" href="/job/{{ .ViewModel.Name }}" uk-icon="history" uk-tooltip="Show job stats and history"></a>
	</td>
	<td> <!-- actions -->
	{{ if .ViewModel.Disabled }}
		<a class="uk-button uk-button-default" href="/job.enable/{{ .ViewModel.Name }}" uk-icon="future" uk-tooltip="Enable the job"></a>
	{{else}}
		<a class="uk-button uk-button-secondary" href="/job.disable/{{ .ViewModel.Name }}" uk-icon="ban" uk-tooltip="Disable the job"></a>
	{{end}}
	{{ if .ViewModel.CanRun }}
		<a class="uk-button uk-button-primary" href="/job.run/{{ .ViewModel.Name }}" uk-icon="play" uk-tooltip="Force the job to run"></a>
	{{ else }}
		<a class="uk-button uk-button-danger" href="/job.cancel/{{ .ViewModel.Name }}" uk-icon="close" uk-tooltip="Cancel the running job"></a>
	{{ end }}
	</td>
</tr>
{{ end }}
